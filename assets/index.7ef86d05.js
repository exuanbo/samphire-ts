var e=Object.assign;import{r as t,a as r,b as n}from"./vendor.f173b16f.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(r){const n=new URL(e,location),l=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((r,a)=>{const s=new URL(e,n);if(self[t].moduleMap[s])return r(self[t].moduleMap[s]);const c=new Blob([`import * as m from '${s}';`,`${t}.moduleMap['${s}']=m;`],{type:"text/javascript"}),o=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(c),onerror(){a(new Error(`Failed to import: ${e}`)),l(o)},onload(){r(self[t].moduleMap[s]),l(o)}});document.head.appendChild(o)})),self[t].moduleMap={}}}("assets/");const l=r=>t.createElement("svg",e({height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},r),t.createElement("path",{d:"M3 22v-20l18 10-18 10z"})),a=r=>t.createElement("svg",e({height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},r),t.createElement("path",{d:"M14 12l-14 9v-18l14 9zm-4-9v4l8.022 5-8.022 5v4l14-9-14-9z"})),s=r=>t.createElement("svg",e({height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},r),t.createElement("path",{d:"M6.974 22.957c-10.957-11.421 2.326-20.865 10.384-13.309l-2.464 2.352h9.106v-8.947l-2.232 2.229c-14.794-13.203-31.51 7.051-14.794 17.675z"})),c=r=>t.createElement("svg",e({"data-icon":"github-alt","data-prefix":"fab",viewBox:"0 0 480 512",xmlns:"http://www.w3.org/2000/svg"},r),t.createElement("path",{d:"M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z",fill:"currentColor"})),o=r=>t.createElement("svg",e({height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},r),t.createElement("path",{d:"M11.885 14.988l3.104-3.098.011.11c0 1.654-1.346 3-3 3l-.115-.012zm8.048-8.032l-3.274 3.268c.212.554.341 1.149.341 1.776 0 2.757-2.243 5-5 5-.631 0-1.229-.13-1.785-.344l-2.377 2.372c1.276.588 2.671.972 4.177.972 7.733 0 11.985-8.449 11.985-8.449s-1.415-2.478-4.067-4.595zm1.431-3.536l-18.619 18.58-1.382-1.422 3.455-3.447c-3.022-2.45-4.818-5.58-4.818-5.58s4.446-7.551 12.015-7.551c1.825 0 3.456.426 4.886 1.075l3.081-3.075 1.382 1.42zm-13.751 10.922l1.519-1.515c-.077-.264-.132-.538-.132-.827 0-1.654 1.346-3 3-3 .291 0 .567.055.833.134l1.518-1.515c-.704-.382-1.496-.619-2.351-.619-2.757 0-5 2.243-5 5 0 .852.235 1.641.613 2.342z"})),m=r=>t.createElement("svg",e({height:"24",viewBox:"0 0 24 24",width:"24",xmlns:"http://www.w3.org/2000/svg"},r),t.createElement("path",{d:"M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z"})),i=({className:e})=>t.createElement("nav",{className:`flex items-center justify-between h-10 px-3 bg-gray-50 ${e}`},t.createElement("div",{className:"flex space-x-3"},t.createElement("button",{className:"flex items-center space-x-1 focus:outline-none"},t.createElement(l,{"aria-hidden":"true",className:"h-4 -ml-1"}),t.createElement("span",null,"Run")),t.createElement("button",{className:"flex items-center space-x-1 focus:outline-none"},t.createElement(a,{"aria-hidden":"true",className:"h-4"}),t.createElement("span",null,"Step")),t.createElement("button",{className:"flex items-center space-x-1 focus:outline-none"},t.createElement(s,{"aria-hidden":"true",className:"h-4"}),t.createElement("span",null,"Reset"))),t.createElement("div",{className:"flex items-center space-x-2"},t.createElement("span",null,"Assembler Simulator"),t.createElement("a",{href:"https://github.com/exuanbo/assembler-simulator",rel:"noopener noreferrer",target:"_blank"},t.createElement(c,{style:{height:"1.2rem"}}))));var u,d;(d=u||(u={})).MOV="MOV",d.ADD="ADD",d.SUB="SUB",d.MUL="MUL",d.DIV="DIV",d.INC="INC",d.DEC="DEC",d.CMP="CMP",d.JMP="JMP",d.JZ="JZ",d.JNZ="JNZ",d.END="END";const p={[u.ADD]:160,[u.SUB]:161,[u.MUL]:162,[u.DIV]:163,[u.INC]:164,[u.DEC]:165},E={[u.ADD]:176,[u.SUB]:177,[u.MUL]:178,[u.DIV]:182},h={[u.JMP]:192,[u.JZ]:193,[u.JNZ]:194},f={[u.MOV]:2,[u.ADD]:2,[u.SUB]:2,[u.MUL]:2,[u.DIV]:2,[u.INC]:1,[u.DEC]:1,[u.CMP]:2,[u.JMP]:1,[u.JZ]:1,[u.JNZ]:1,[u.END]:0};var g,v;(v=g||(g={})).Number="Number",v.Address="Address",v.Register="Register",v.RegisterPointer="RegisterPointer";const w={[g.Number]:/^([0-9A-F]{1,2})$/,[g.Address]:/^\[([0-9A-F]{1,2})\]$/,[g.Register]:/^([ABCD]L)$/,[g.RegisterPointer]:/^\[([ABCD]L)\]$/};var b,N;(N=b||(b={})).AL="AL",N.BL="BL",N.CL="CL",N.DL="DL";const x={[b.AL]:0,[b.BL]:1,[b.CL]:2,[b.DL]:3},y=e=>{const t=(e=>t=>{var r;const n=null==(r=w[t].exec(e))?void 0:r[1];if(void 0!==n){const e=(()=>{switch(t){case g.Number:case g.Address:return Number.parseInt(n,16);case g.Register:case g.RegisterPointer:return x[n]}})();return{type:t,value:e}}return null})(e);for(const r of Object.values(g)){const e=t(r);if(null!==e)return e}throw new Error(`Invalid operand ${e}`)},M=e=>void 0!==e,D=e=>e.toString(16).padStart(2,"0").toUpperCase(),$=e=>{const[t]=Object.entries(x).map((([t,r])=>{if(r===e)return t})).filter(M);return t},C=e=>{const t=D(e.value);switch(e.type){case g.Number:return`${t}`;case g.Address:return`[${t}]`;case g.Register:return $(e.value);case g.RegisterPointer:return`[${$(e.value)}]`}},R=(e,t,r)=>{switch(e){case u.MOV:return((e,t)=>{if(e.type===g.Number)throw new Error(`The first operand of MOV can not be number, but got ${C(e)}`);switch(e.type){case g.Register:switch(t.type){case g.Number:return 208;case g.Address:return 209;case g.RegisterPointer:return 211;case g.Register:default:throw new Error(`The second operand of MOV can not be register, but got ${C(t)}`)}case g.Address:case g.RegisterPointer:if(t.type===g.Register)return e.type===g.Address?210:212;throw new Error(`The second operand of MOV must be register, but got ${C(t)}`)}})(t,r);case u.ADD:case u.SUB:case u.MUL:case u.DIV:case u.INC:case u.DEC:return((e,t,r)=>{if(t.type!==g.Register)throw new Error(`The first operand of ${e} must be register, but got ${C(t)}`);if(void 0===r)return p[e];switch(r.type){case g.Register:return p[e];case g.Number:return E[e];case g.Address:case g.RegisterPointer:throw new Error(`The second operand of ${e} must be register or number, but got ${C(r)}`)}})(e,t,r);case u.CMP:return((e,t)=>{if(e.type!==g.Register)throw new Error(`The first operand of CMP must be register, but got ${C(e)}`);switch(t.type){case g.Register:return 218;case g.Number:return 219;case g.Address:return 220;case g.RegisterPointer:throw new Error(`The second operand of CMP can not be address with register, but got ${C(t)}`)}})(t,r);case u.JMP:case u.JZ:case u.JNZ:return h[e]}},L=e=>new Uint8Array(256).map(((t,r)=>e&&r>=192?32:0)),A=e=>{const t=L(!0);let r=0;return e.statements.forEach((e=>{const n=(e=>{const{instruction:t,operands:r}=e;if(t===u.END)return[0];if(null!==r){const[e,n]=r,l=y(e),a=void 0!==n?y(n):void 0;return[R(t,l,a),l.value,null==a?void 0:a.value].filter(M)}return null})(e);null!==n&&n.forEach((e=>{t[r]=e,r++}))})),t},P=r("mov al, 5A\nmov bl, D3\n\nloop:\nmov [bl], al\ndec al\ncmp al, 40\njz done\ninc bl\njz reset\njmp loop\n\nreset:\nmov bl, c0\njmp loop\n\ndone:\nend\n"),S=r({statements:[],labels:[]}),U=r(L(!0)),I=r(null),B=()=>{const[e]=I.useState();return t.createElement("div",{className:"px-3 py-1 text-white "+(null===e?"bg-blue-500":"bg-red-500")},null===e?"Looks good so far :D":e)},z=e=>e.split("\n").map((e=>{var t;const r=e.replace(/;.*/,"").trim().toUpperCase();if(0===r.length)return;if(r.endsWith(":"))return{instruction:r,operands:null};const n=r.search(/\s/),l=r.slice(0,-1===n?r.length:n);if(!(e=>e in u)(l))throw new Error(`Invalid instruction ${l}`);const a=-1===n?null:r.slice(n).replace(/\s/g,"").split(","),s=null!=(t=null==a?void 0:a.length)?t:0;if(s>2)throw new Error(`Got ${s} (> 2) operands`);const c=f[l];if(s!==c)throw new Error(`Expect ${l} to have ${c} operand${c>1?"s":""}, but got ${s}`);return{instruction:l,operands:null!==a?s>1?[a[0],a[1]]:[a[0]]:null}})).filter(M),J=(e,t)=>t.slice(0,e).map((e=>{var t,r;return 1+(null!=(r=null==(t=e.operands)?void 0:t.length)?r:0)})).reduce(((e,t)=>e+t)),O=(e,t)=>t.map(((r,n)=>((e=>[u.JMP,u.JZ,u.JNZ].some((t=>e.instruction===t)))(r)&&e.forEach((e=>{if(r.operands[0]===e.name){const l=J(n,t),a=e.address-l,s=D(a>0?a:256+a);r.operands=[s]}})),r))),j=e=>!e.instruction.endsWith(":"),k=e=>(e=>{let t=0;const r=e.map(((r,n)=>{if(!j(r)){const l=J(n,e)-t;return t++,{name:r.instruction.slice(0,-1),address:l}}})).filter(M),n=e.filter(j);return{statements:O(r,n),labels:r}})(z(e)),V=({className:e})=>{const[r,n]=P.useState(),[,l]=S.useState(),[,a]=U.useState(),[,s]=I.useState(),c=t.useRef(null),o=()=>{try{const e=k(r);l(e);const t=A(e);a(t),s(null)}catch(e){s(e.message)}};return t.useEffect((()=>{const e=setTimeout(o,200);return()=>{clearTimeout(e)}}),[r]),t.createElement("div",{className:`flex flex-col ${e}`},t.createElement("textarea",{ref:c,className:"w-full h-full px-3 py-1 font-mono resize-none focus:outline-none",spellCheck:!1,value:r,onChange:e=>{n(e.target.value)},onKeyDown:e=>{if("Tab"===e.key){e.preventDefault();const{current:t}=c;if(null!==t){const{selectionStart:e,selectionEnd:r,value:n}=t;t.value=n.substring(0,e)+"\t"+n.substring(r),t.selectionStart=t.selectionEnd=e+1}}}}),t.createElement(B,null))},Z=({className:e,title:r,Icon:n,onIconClick:l,children:a})=>t.createElement("div",{className:e},t.createElement("header",{className:"flex justify-between w-full px-3 py-1 border-b bg-gray-50"},t.createElement("span",null,r),void 0!==n?t.createElement("button",{className:"flex flex-col justify-center focus:outline-none",onClick:l},t.createElement(n,null)):null),a),T=()=>t.createElement(Z,{title:"Input / Output Devices"}),_=()=>t.createElement(Z,{title:"CPU Registers"}),F=()=>{const[e]=U.useState(),r=(n=16,e.reduce(((e,t,r)=>{const l=Math.floor(r/n);return void 0===e[l]&&(e[l]=[]),e[l].push(t),e}),[]));var n;return t.createElement(Z,{title:"Memory"},t.createElement("table",{className:"w-full font-mono text-sm leading-tight divide-y"},t.createElement("thead",null,t.createElement("tr",{className:"divide-x bg-gray-50"},t.createElement("th",null),r[0].map(((e,r)=>t.createElement("th",{key:`col-index-${r}`,className:"text-center"},D(r)[1]))))),t.createElement("tbody",{className:"divide-y"},r.map(((e,r)=>t.createElement("tr",{key:`row-${r}`,className:"divide-x"},t.createElement("td",{className:"text-center bg-gray-50"},D(r)[1]),e.map(((e,n)=>t.createElement("td",{key:`row-${r}-col-${n}`,className:"text-center"},D(e))))))))))},W=()=>{const[e,r]=t.useState(!0),[{statements:n,labels:l}]=S.useState();return t.createElement(Z,{Icon:()=>e?t.createElement(o,{className:"h-4"}):t.createElement(m,{className:"h-4"}),title:"Tokens",onIconClick:()=>{r(!e)}},e?t.createElement("div",{className:"flex divide-x"},t.createElement(Z,{className:"flex-1",title:"Statements"},t.createElement("div",{className:"px-3 py-1 border-b"},n.length>0?t.createElement("table",{className:"w-full text-sm leading-narrow"},t.createElement("thead",null,t.createElement("tr",{className:"text-left"},t.createElement("th",null,"Instruction"),t.createElement("th",null,"Operand"),t.createElement("th",null,"Operand"))),t.createElement("tbody",null,n.map(((e,r)=>{var n;return t.createElement("tr",{key:`statement-${r}`},t.createElement("td",null,e.instruction),null==(n=e.operands)?void 0:n.map(((e,n)=>t.createElement("td",{key:`statement-${r}-operand-${n}`,className:"font-mono"},e))))})))):null)),t.createElement(Z,{className:"flex-1",title:"Labels"},t.createElement("div",{className:"px-3 py-1 border-b"},l.length>0?t.createElement("table",{className:"w-full text-sm leading-narrow"},t.createElement("thead",null,t.createElement("tr",{className:"text-left"},t.createElement("th",null,"Name"),t.createElement("th",null,"Address"))),t.createElement("tbody",null,l.map(((e,r)=>t.createElement("tr",{key:`label-${r}`},t.createElement("td",null,e.name),t.createElement("td",{className:"font-mono"},D(e.address))))))):null))):null)},G=()=>t.createElement("div",{className:"flex flex-col w-screen h-screen divide-y"},t.createElement(i,{className:"flex-none"}),t.createElement("div",{className:"flex h-full divide-x"},t.createElement(V,{className:"flex-1"}),t.createElement("div",{className:"flex-1 divide-y"},t.createElement(T,null),t.createElement(_,null),t.createElement(F,null),t.createElement(W,null))));n.render(t.createElement(t.StrictMode,null,t.createElement(G,null)),document.getElementById("root"));
